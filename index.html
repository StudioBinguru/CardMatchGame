<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>CardMatchGame</title>

    <!-- Firebase v8 CDN -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <!-- Firebase 초기화 및 Unity 호출 함수 정의 -->
    <script>
      var firebaseConfig = {
        apiKey: "AIzaSyAMk7TPjeVCzpNpOwcAEOfaenIRvbwgaNg",
        authDomain: "cardmatchgame-2a2af.firebaseapp.com",
        databaseURL: "https://cardmatchgame-2a2af-default-rtdb.firebaseio.com",
        projectId: "cardmatchgame-2a2af",
        storageBucket: "cardmatchgame-2a2af.appspot.com",
        messagingSenderId: "867887350190",
        appId: "1:867887350190:web:e5500ca2209120826e083f",
        measurementId: "G-KCK0QTF6BT"
      };

      // Firebase 초기화
      firebase.initializeApp(firebaseConfig);

      // Unity에서 호출할 전역 함수
      window.UploadScoreToFirebase = function (playerId, stage, score) {
        if (!firebase || !firebase.database) {
          console.error("Firebase가 아직 초기화되지 않았습니다.");
          return;
        }

        firebase.database().ref("scores").push({
          playerId: playerId,
          stage: stage,
          score: score,
          timestamp: new Date().toISOString()
        }).then(() => {
          console.log(" Firebase 기록 성공");
        }).catch((err) => {
          console.error(" Firebase 기록 실패:", err);
        });
      };
    </script>

    <style>
      html, body {
        margin: 0;
        height: 100%;
        background: black;
        overflow: hidden;
      }

      #unity-container {
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      canvas {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>

  <body>
    <div id="unity-container">
      <canvas id="unity-canvas"></canvas>
    </div>

    <!-- Unity WebGL 로더 -->
    <script>
      const buildUrl = ".";
      const loaderUrl = buildUrl + "/CardMatchGame.loader.js";
      const config = {
        dataUrl: buildUrl + "/CardMatchGame.data",
        frameworkUrl: buildUrl + "/CardMatchGame.framework.js",
        codeUrl: buildUrl + "/CardMatchGame.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "StudioBinguru",
        productName: "CardMatchGame",
        productVersion: "1.0",
      };

      const script = document.createElement("script");
      script.src = loaderUrl;
      script.onload = () => {
        createUnityInstance(document.querySelector("#unity-canvas"), config, (progress) => {
          console.log(`로딩 중: ${Math.floor(progress * 100)}%`);
        }).then((unityInstance) => {
          console.log(" Unity WebGL 로드 완료");
        }).catch((err) => {
          alert(" Unity 로딩 실패: " + err);
        });
      };
      document.body.appendChild(script);
    </script>
  </body>
</html>
